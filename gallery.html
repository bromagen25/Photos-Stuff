<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rugby Photo Gallery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000;
            color: #FF0000;
        }
        .gallery-image {
            transition: transform 0.2s ease-in-out;
        }
        .gallery-image:hover {
            transform: scale(1.05);
            cursor: pointer;
        }
        .modal {
            background-color: rgba(0, 0, 0, 0.9);
            transition: opacity 0.3s ease-in-out;
        }
        .modal-content {
            max-height: 90vh;
            max-width: 90vw;
            object-fit: contain;
            cursor: pointer;
        }
        .spinner {
            border: 8px solid rgba(255, 255, 255, 0.3);
            border-top: 8px solid #ffffff;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            z-index: 50;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .nav-button.active {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border: 2px solid;
        }
        .gallery-section-bg {
            background-color: #1a1a1a;
        }
        .nav-button.bg-red-700.active { border-color: #b91c1c; }

        #clickToSourceText {
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        #clickToSourceText.visible {
            opacity: 1;
        }

        /* Styles for navigation buttons */
        .modal-nav-button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-size: 2.5rem;
            background: rgba(0, 0, 0, 0.5);
            padding: 1rem 1.5rem;
            border-radius: 9999px;
            cursor: pointer;
            z-index: 55;
            transition: background-color 0.2s ease;
            display: none; /* Hide by default for mobile */
        }
        .modal-nav-button:hover {
            background: rgba(0, 0, 0, 0.7);
        }

        /* Show navigation buttons only on larger screens */
        @media (min-width: 768px) {
            .modal-nav-button {
                display: block;
            }
        }
        #prevButton { left: 2rem; }
        #nextButton { right: 2rem; }
    </style>
</head>
<body class="bg-black min-h-screen flex flex-col items-center py-8">

    <header class="w-full max-w-7xl flex justify-between items-center mb-12 p-4 bg-gray-900 rounded-xl shadow-lg">
        <h1 id="mainTitle" class="text-3xl sm:text-4xl font-extrabold text-red-600"></h1>
        <nav class="flex space-x-4">
            <a href="index.html" class="flex items-center space-x-2 px-4 py-2 bg-red-700 text-white rounded-lg hover:bg-red-800 transition duration-300 transform hover:scale-105">
                <i class="fas fa-home"></i>
                <span class="hidden sm:inline">Home</span>
            </a>
        </nav>
    </header>

    <nav id="subGalleryNav" class="mb-10 p-4 bg-gray-900 rounded-xl shadow-xl flex flex-wrap justify-center gap-4 hidden">
        </nav>

    <div id="gallery" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 p-6 max-w-7xl mx-auto gallery-section-bg rounded-xl shadow-2xl">
        </div>

    <div id="imageModal" class="fixed inset-0 flex items-center justify-center z-50 hidden modal opacity-0">
        <div class="relative flex flex-col items-center justify-center w-full h-full">
            <button id="closeModal" class="absolute top-4 right-4 text-white text-4xl p-2 rounded-full bg-gray-700 bg-opacity-50 hover:bg-opacity-75 focus:outline-none z-55" aria-label="Close image modal">
                <i class="fas fa-times"></i>
            </button>
            <div id="loadingSpinner" class="spinner absolute z-50 hidden"></div>
            <img id="modalImage" src="" alt="Gallery Image" class="modal-content rounded-lg shadow-lg">
            
            <div id="clickToSourceText" class="absolute bottom-8 text-white text-lg bg-black bg-opacity-50 px-4 py-2 rounded-lg hidden transition-opacity duration-300 opacity-0">
                Click image to view host page
            </div>
            
            <button id="prevButton" class="modal-nav-button">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button id="nextButton" class="modal-nav-button">
                <i class="fas fa-chevron-right"></i>
            </button>

        </div>
    </div>

    <script>
        let currentImageIndex = 0;
        let imageUrls = [];
        let lastClickTime = 0;
        const DOUBLE_CLICK_TIME = 300;
        let clickToSourceTextTimeout;

        const mainTitle = document.getElementById('mainTitle');
        const galleryDiv = document.getElementById('gallery');
        const subGalleryNav = document.getElementById('subGalleryNav');
        const imageModal = document.getElementById('imageModal');
        const modalImage = document.getElementById('modalImage');
        const closeModalBtn = document.getElementById('closeModal');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const clickToSourceText = document.getElementById('clickToSourceText');
        const prevButton = document.getElementById('prevButton');
        const nextButton = document.getElementById('nextButton');

        async function loadGallery() {
            const urlParams = new URLSearchParams(window.location.search);
            const galleryId = urlParams.get('id');

            if (!galleryId) {
                mainTitle.textContent = "Gallery Not Found";
                galleryDiv.innerHTML = '<p class="text-center text-gray-500 text-lg col-span-full">No gallery ID provided.</p>';
                return;
            }

            try {
                const response = await fetch('galleries.json');
                const allGalleries = await response.json();
                const galleryData = allGalleries.find(g => g.id === galleryId);

                if (!galleryData) {
                    mainTitle.textContent = "Gallery Not Found";
                    galleryDiv.innerHTML = '<p class="text-center text-gray-500 text-lg col-span-full">The requested gallery does not exist.</p>';
                    return;
                }

                mainTitle.textContent = galleryData.name;

                if (galleryData.subGalleries && galleryData.subGalleries.length > 0) {
                    subGalleryNav.classList.remove('hidden');
                    createSubGalleryButtons(galleryData.subGalleries);
                    loadSubGallery(galleryData.subGalleries[0].images, 0);
                } else if (galleryData.images) {
                    subGalleryNav.classList.add('hidden');
                    loadGalleryImages(galleryData.images);
                } else {
                    galleryDiv.innerHTML = '<p class="text-center text-gray-500 text-lg col-span-full">This gallery has no images.</p>';
                }
            } catch (error) {
                console.error('Error loading galleries:', error);
                mainTitle.textContent = "Error";
                galleryDiv.innerHTML = '<p class="text-center text-red-500 text-lg col-span-full">Failed to load gallery data.</p>';
            }
        }

        function createSubGalleryButtons(subGalleries) {
            subGalleryNav.innerHTML = '';
            subGalleries.forEach((sub, index) => {
                const button = document.createElement('button');
                button.textContent = sub.name;
                button.className = 'nav-button px-4 py-2 bg-red-700 text-white rounded-lg hover:bg-red-800 transition duration-300 transform hover:scale-105';
                button.addEventListener('click', () => {
                    document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    loadSubGallery(sub.images, index);
                });
                subGalleryNav.appendChild(button);
                if (index === 0) {
                    button.classList.add('active');
                }
            });
        }

        function loadGalleryImages(images) {
            galleryDiv.innerHTML = '';
            imageUrls = images;
            
            if (images.length === 0) {
                galleryDiv.innerHTML = '<p class="text-center text-gray-500 text-lg col-span-full">No images found for this gallery.</p>';
                return;
            }

            images.forEach((url, index) => {
                const imgContainer = document.createElement('div');
                imgContainer.className = 'relative group rounded-lg overflow-hidden shadow-md hover:shadow-xl transition-all duration-300';
                
                const img = document.createElement('img');
                img.src = url;
                img.alt = `Gallery Image ${index + 1}`;
                img.className = 'w-full h-48 object-cover gallery-image transform group-hover:scale-105 rounded-lg';
                img.loading = 'lazy';
                img.onerror = function() {
                    this.src = 'https://placehold.co/400x300/cccccc/333333?text=Image+Error';
                    this.alt = 'Image failed to load';
                    console.error(`Error loading image: ${url}`);
                };
                
                const overlay = document.createElement('div');
                overlay.className = 'absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center';
                const viewIcon = document.createElement('i');
                viewIcon.className = 'fas fa-eye text-white text-3xl opacity-0 group-hover:opacity-100 transition-opacity duration-300';
                overlay.appendChild(viewIcon);
                
                imgContainer.appendChild(img);
                imgContainer.appendChild(overlay);
                imgContainer.addEventListener('click', () => openModal(index));
                galleryDiv.appendChild(imgContainer);
            });
        }

        function loadSubGallery(images, subGalleryIndex) {
            galleryDiv.innerHTML = '';
            loadGalleryImages(images);
        }

        function openModal(index) {
            currentImageIndex = index;
            loadingSpinner.classList.remove('hidden');
            modalImage.classList.add('hidden');
            clickToSourceText.classList.remove('visible');
            clickToSourceText.classList.add('hidden');
            clearTimeout(clickToSourceTextTimeout);

            setTimeout(() => {
                modalImage.src = imageUrls[currentImageIndex];
                modalImage.onerror = function() {
                    this.src = 'https://placehold.co/800x600/cccccc/333333?text=Image+Error';
                    this.alt = 'Image failed to load';
                    loadingSpinner.classList.add('hidden');
                    modalImage.classList.remove('hidden');
                    console.error(`Error loading modal image: ${imageUrls[currentImageIndex]}`);
                };
                modalImage.onload = function() {
                    loadingSpinner.classList.add('hidden');
                    modalImage.classList.remove('hidden');
                    
                    clickToSourceText.classList.remove('hidden');
                    setTimeout(() => {
                        clickToSourceText.classList.add('visible');
                    }, 10);

                    clickToSourceTextTimeout = setTimeout(() => {
                        clickToSourceText.classList.remove('visible');
                        setTimeout(() => {
                            clickToSourceText.classList.add('hidden');
                        }, 500);
                    }, 3000);
                };
            }, 50);
            imageModal.classList.remove('hidden');
            setTimeout(() => {
                imageModal.classList.remove('opacity-0');
            }, 10);
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            imageModal.classList.add('opacity-0');
            clearTimeout(clickToSourceTextTimeout);
            clickToSourceText.classList.remove('visible');
            clickToSourceText.classList.add('hidden');

            setTimeout(() => {
                imageModal.classList.add('hidden');
                modalImage.src = '';
                document.body.style.overflow = '';
            }, 300);
        }

        function showNextImage() {
            currentImageIndex = (currentImageIndex + 1) % imageUrls.length;
            openModal(currentImageIndex);
        }

        function showPrevImage() {
            currentImageIndex = (currentImageIndex - 1 + imageUrls.length) % imageUrls.length;
            openModal(currentImageIndex);
        }

        closeModalBtn.addEventListener('click', closeModal);
        prevButton.addEventListener('click', showPrevImage);
        nextButton.addEventListener('click', showNextImage);

        modalImage.addEventListener('click', (e) => {
            const clickTime = new Date().getTime();
            if (clickTime - lastClickTime < DOUBLE_CLICK_TIME) {
                e.stopPropagation();
                if (modalImage.src && !modalImage.classList.contains('hidden')) {
                    const parts = modalImage.src.split('/');
                    const imageId = parts[parts.length - 2]; 
                    if (imageId && imageId.length > 0) {
                        const postimgPageUrl = `https://postimg.cc/${imageId}`;
                        window.open(postimgPageUrl, '_blank');
                    } else {
                        console.error('Could not extract image ID from URL:', modalImage.src);
                        window.open(modalImage.src, '_blank');
                    }
                }
            }
            lastClickTime = clickTime;
        });

        imageModal.addEventListener('click', (e) => {
            if (e.target === imageModal) { 
                closeModal();
            }
        });

        document.addEventListener('keydown', (e) => {
            if (!imageModal.classList.contains('hidden')) {
                if (e.key === 'ArrowRight') {
                    showNextImage();
                } else if (e.key === 'ArrowLeft') {
                    showPrevImage();
                } else if (e.key === 'Escape') {
                    closeModal();
                }
            }
        });

        let touchStartX = 0;
        let touchEndX = 0;
        modalImage.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
        });
        modalImage.addEventListener('touchend', (e) => {
            touchEndX = e.changedTouches[0].clientX;
            const swipeThreshold = 50;
            if (touchEndX < touchStartX - swipeThreshold) {
                showNextImage();
            } else if (touchEndX > touchStartX + swipeThreshold) {
                showPrevImage();
            }
        });

        document.addEventListener('DOMContentLoaded', loadGallery);
    </script>
</body>
</html>
